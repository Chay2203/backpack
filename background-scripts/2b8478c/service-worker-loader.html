<html><head><title>service worker loader</title><style>body{background:red}</style></head><body> <script type="module">var e;e=new URL("service-worker.js",import.meta.url).toString(),async function(){const o=window.location.href,t=document.createElement("div");t.innerHTML=o;document.getElementsByTagName("body")[0].appendChild(t);const r=await navigator.serviceWorker.getRegistrations();console.log("# SERVICE WORKERS",r.length);for(let e of r)console.log("SERVICE WORKER: exists, unregistering...",e),await e.unregister(),console.log("SERVICE WORKER: exists, unregistered");try{const o=await navigator.serviceWorker.register(e);document.querySelector("body").style.background="yellow",console.log("SERVICE WORKER: registered",o)}catch(e){console.log("SERVICE WORKER: registration failed",e)}navigator.serviceWorker.addEventListener("install",(e=>{console.log("SERVICE WORKER: installing",e),document.querySelector("body").style.background="orange"})),navigator.serviceWorker.addEventListener("activate",(e=>{console.log("SERVICE WORKER: activating",e),document.querySelector("body").style.background="blue"})),navigator.serviceWorker.onmessage=e=>{console.log("SERVICE WORKER: message received",e),document.querySelector("body").style.background="green",window.ReactNativeWebView?.postMessage(JSON.stringify(e.data))},window.postMessageToBackgroundViaWebview=e=>{console.log("SERVICE WORKER: message sent",e),navigator.serviceWorker.controller.postMessage(e)}}();</script> </body></html>